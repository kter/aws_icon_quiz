<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router/dist/vue-router.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuex/dist/vuex.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>

  <body>
    <div id="app">
      <router-link to="/top">トップページに戻る</router-link>
      <router-view></router-view>
    </div>

    <script type="text/x-template" id="top">
      <div>
        <h1>AWS Icon Quiz</h1>
        <div>
          <router-link :to="{ name: 'questions', params: { questionId: 1 }}">
            はじめる
          </router-link>
        </div>
      </div>
    </script>

    <script type="text/x-template" id="questions">
        <div>
            <h1>AWS Icon Quiz</h1>
            <form>
                <div>
                    <div>
                        Question: {{ this.Questions[parseInt(this.$route.params.questionId)].question }}
                    </div>
                    <div>
                        Answers:
                        <div v-for="answer in this.Questions[parseInt(this.$route.params.questionId)].answer" :key="answer">
                            <input type="radio" name="answer" :id="`${answer}`" :value="`${answer}`" v-model="playerAnswer" :key="`${$route.params.questionId}`">
                            <label :for="`${answer}`">{{ answer }}</label>
                        </div>
                    </div>
                </div>
                <div v-if="isLastQuestion()">
                    <router-link :to="{ name: 'result' }">
                        答え合わせ
                    </router-link>
                </div>
                <div v-else>
                    <router-link :to="{ name: 'questions', params: { questionId: parseInt(this.$route.params.questionId) + 1 }}">
                        次へ
                    </router-link>
                </div>
            </form>
        </div>
    </script>

    <script type="text/x-template" id="result">
        <div>
            <div>
                結果発表
            </div>
            <div>
                あなたの得点は…
                <div>
                    {{ getScore() }}
                </div>
                でした！
            </div>
        </div>
    </script>

    <script>
        /*
         * Store
         */
        const store = new Vuex.Store({
            state: {
                "playerAnswers": {},
            },
            mutations: {
                addAnswer(state, answer) {
                    state.playerAnswers[answer.order] = answer.choosedAnswer;
                }
            },
        });

        /*
         * Resultコンポーネント
         */
        var resultPage = {
            template: '#result',
            props: {
                playerAnswers: {
                    type: Object
                }
            },
            methods: {
                getScore: function () {
                }
            },
        };

        /*
         * Questionsコンポーネント
         */
        var questionPage = {
            template: '#questions',
            methods: {
                fetchQuestion: function () {
                    /**
                     * 想定レスポンス
                     * [
                     *    {
                     *      "question": "4b88d56bd65ef92611ac63064c38369f",
                     *      "answer": [
                     *        "Amazon EMR",
                     *        "Amazon EC2",
                     *        "Amazon S3",
                     *        "Amazon CloudWatch"
                     *      ],
                     *      "correct": "Amazon CloudWatch"
                     *    },
                     * ]
                     */
                    axios
                        .get('https://uwnbp575z0.execute-api.us-east-1.amazonaws.com/prod/questions')
                        .then(response => (this.Questions = response.data))
                },
                isLastQuestion: function () {
                    const numberOfQuestion = 20;
                    return this.$route.params.questionId >= numberOfQuestion
                },
            },
            store,
            computed: {
                playerAnswer: {
                    get() {
                        return this.$store.state.playerAnswers;
                    },
                    set(answer) {
                        this.$store.commit("addAnswer", { choosedAnswer: answer, order: parseInt(this.$route.params.questionId) });
                    }
                }
            },
            created: function () {
                this.fetchQuestion(parseInt())
            },
            data: function () {
                return {
                    "Questions": [],
                    "Category" : {
                        "Analytics": [
                            {
                                file_path: "Athena.png",
                                name: "Amazon Athena",
                            },
                            {
                                file_path: "CloudSearch.png",
                                name: "Amazon CloudSearch",
                            },
                            {
                                file_path: "Data_Pipeline.png",
                                name: "AWS Data Pipeline",
                            },
                            {
                                file_path: "Elasticsearch_Service.png",
                                name: "Amazon Elasticsearch Service",
                            },
                            {
                                file_path: "EMR.png",
                                name: "Amazon EMR",
                            },
                            {
                                file_path: "Glue.png",
                                name: "AWS Glue",
                            },
                            {
                                file_path: "Kinesis.png",
                                name: "Amazon Kinesis",
                            },
                            {
                                file_path: "Lake_Formation.png",
                                name: "AWS Lake Formation",
                            },
                            {
                                file_path: "Quicksight.png",
                                name: "Amazon QuickSight",
                            },
                            {
                                file_path: "Redshift.png",
                                name: "Amazon Redshift",
                            }
                        ],
                        "Application-Integration": [
                            {
                                file_path: "AWS-Step-Functions.png",
                                name: "AWS Step Functions",
                            },
                            {
                                file_path: "Amazon-AppSync.png",
                                name: "Amazon AppSync",
                            },
                            {
                                file_path: "Amazon-EventBridge.png",
                                name: "Amazon EventBridge",
                            },
                            {
                                file_path: "Amazon-MQ.png",
                                name: "Amazon MQ",
                            },
                            {
                                file_path: "Amazon-Simple-Notification-Service-SNS.png",
                                name: "Amazon Simple Notification Service",
                            },
                            {
                                file_path: "Amazon-Simple-Queue-Service-SQS.png",
                                name: "Amazon Simple Queue Service",
                            },
                            {
                                file_path: "Application-Integration.png",
                                name: "Application Integration",
                            },
                        ]
                    }
                }
            }
        }

        /*
         * Topコンポーネント
         */
        var topPage = {
            template: '#top',
        }

        var router = new VueRouter({
            routes: [
                {
                    path: '/top',
                    name: 'top',
                    component: topPage
                },
                {
                    path: '/questions/:questionId',
                    name: 'questions',
                    component: questionPage,
                },
                {
                    path: '/result',
                    name: 'result',
                    component: resultPage,
                },
            ]
        });

        var vm = new Vue({
            router: router,
        }).$mount('#app')
    </script>
  </body>
<!-- TODO: $routesに依存しているコンポーネントをpropsを使ってこのコンポーネントを使い回せるようにする -->
<!-- TODO: コンポーネントを複数のファイルに分割する
import Home from '@/views/Home'
import Product from '@/views/Product'
// Vuexと同様で最初にプラグインとして登録
Vue.use(VueRouter)
// VueRouterインスタンスを生成する
const router = new VueRouter({
  // URLのパスと紐づくコンポーネントをマッピング
  routes: [
    {
      path: '/',
      component: Home
    },
    {
      path: '/product',
      component: Product
    }
  ]
})
-->
</html>
